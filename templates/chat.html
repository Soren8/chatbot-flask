<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #system-prompt { width: 100%; height: 100px; margin-bottom: 10px; }
        #chat-box { height: 400px; border: 1px solid #ddd; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
        #user-input { width: 100%; padding: 5px; }
        .user-message { color: blue; margin-bottom: 10px; }
        .ai-message {
            color: green;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            margin-bottom: 10px;
        }
        .error-message { color: red; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>AI Chat</h1>
    <textarea id="system-prompt" placeholder="Enter custom system prompt here...">You are a helpful AI assistant named Llama. You are knowledgeable, friendly, and always strive to provide accurate information.</textarea>
    <button id="update-prompt">Update System Prompt</button>
    <div id="chat-box"></div>
    <input type="text" id="user-input" placeholder="Type your message here...">

    <script>
        $(document).ready(function() {
            function sendMessage() {
                var userMessage = $('#user-input').val();
                var systemPrompt = $('#system-prompt').val();
                if (userMessage.trim() === '') return;

                $('#chat-box').append('<p class="user-message"><strong>You:</strong> ' + userMessage + '</p>');
                $('#user-input').val('');

                var requestData = {
                    message: userMessage,
                    system_prompt: systemPrompt
                };

                $.ajax({
                    url: '/chat',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(requestData),
                    success: function(response) {
                        if (response.error) {
                            $('#chat-box').append('<p class="error-message"><strong>Error:</strong> ' + response.error + '</p>');
                        } else {
                            if (response.system_prompt !== systemPrompt) {
                                $('#system-prompt').val(response.system_prompt);
                            }
                            $('#chat-box').append('<pre class="ai-message"><strong>AI:</strong> ' + response.response + '</pre>');
                        }
                        $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        $('#chat-box').append('<p class="error-message"><strong>Error:</strong> ' + errorThrown + '</p>');
                    }
                });
            }

            function updateSystemPrompt() {
                var systemPrompt = $('#system-prompt').val();
                
                $.ajax({
                    url: '/update_system_prompt',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({system_prompt: systemPrompt}),
                    success: function(response) {
                        if (response.error) {
                            $('#chat-box').append('<p class="error-message"><strong>Error:</strong> ' + response.error + '</p>');
                        } else {
                            $('#chat-box').append('<p class="system-message"><strong>System:</strong> System prompt updated successfully.</p>');
                        }
                        $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        $('#chat-box').append('<p class="error-message"><strong>Error:</strong> ' + errorThrown + '</p>');
                    }
                });
            }

            $('#user-input').keypress(function(e) {
                if (e.which == 13) {
                    sendMessage();
                    return false;
                }
            });

            $('#update-prompt').click(function() {
                updateSystemPrompt();
            });
        });
    </script>
</body>
</html>